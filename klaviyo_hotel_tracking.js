(()=>{function m(d){return!d||d.length<5?!1:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d)}var w={cb_booking_engine_load:"Viewed Booking Engine",view_item:"Viewed Listing",add_to_cart:"Viewed Listing",begin_checkout:"Started Checkout"};function b(){return window.location.href.indexOf("/guests")>-1||document.getElementById("guest-form")}function x(d){let c,g,u,h=!1,a=!1;if(d.length&&d[0]==="event"&&typeof d[1]=="string")try{c=d[1],g=d[2]||{},u=g.items,a=!0}catch(f){}if(!a)try{c=d.event,g=d.ecommerce||{},u=g.items,h=!0}catch(f){}return{eventName:c,ecommerceData:g,ecommerceItems:u,isGA4Event:h,isGtagEvent:a}}(function(){function d(t){let e=window.klaviyo||[],{eventName:o,ecommerceData:i,ecommerceItems:n}=x(t);if(o==="form_start"){let r=t.eventModel||i.eventModel;r&&((r.form_id==="guest-form"||r.first_field_name==="email"||r.first_field_type==="email")&&(setTimeout(function(){typeof f<"u"&&f("form_start event")},500),setTimeout(function(){typeof p<"u"&&p()},1e3)))}if(o==="form_interaction"||o==="gtm.formInteract"){let r=t["gtm.element"];r&&(r.name==="email"||r.name==="phoneNumber")&&void 0}o&&w[o]?(w[o],o=="cb_booking_engine_load"||o=="view_item"?n&&n.length>0?c(n[0],i):i&&Object.keys(i).length>1?c(i,i):void 0:o=="add_to_cart"?n&&n.length>0&&c(n[0],i):o=="begin_checkout"&&(g(n,i),setTimeout(function(){typeof f<"u"&&f("begin_checkout event")},500),setTimeout(function(){typeof p<"u"&&p()},1e3))):void 0}function c(t,e){let o=window.klaviyo||[];if(!t||!t.item_name&&!t.name&&!t.item_id&&!t.id){return}let i={Title:t.item_name||t.name||"",ID:t.item_id||t.id||"",Price:t.price||0,URL:window.location.href,$value:t.price||0};(t.affiliation||t.item_brand)&&(i["Property Name"]=t.affiliation||t.item_brand),t.item_category&&(i["Property Type"]=t.item_category),e.city&&(i["Listing City"]=e.city),e.country&&(i["Listing Country"]=e.country),(t.image_url||t.item_image)&&(i.ImageURL=t.image_url||t.item_image),i.$extra={},(t.start_date||e.start_date)&&(i.$extra.start_date=t.start_date||e.start_date),(t.end_date||e.end_date)&&(i.$extra.end_date=t.end_date||e.end_date),t.total_guests&&(i.$extra.total_guests=t.total_guests),t.adults&&(i.$extra.adults=t.adults),t.kids&&(i.$extra.kids=t.kids),(t.nights||t.quantity)&&(i.$extra.nights=t.nights||t.quantity),t.item_category2&&(i.$extra.room_type=t.item_category2),t.item_variant&&(i.$extra.rate_plan=t.item_variant),(t.item_package_name||t.item_package_id)&&(i.$extra.package_name=t.item_package_name,i.$extra.package_id=t.item_package_id),e.property_id&&(i.$extra.property_id=e.property_id),o.track("Viewed Listing",i)}function g(t,e){let o=window.klaviyo||[],i=0,n={},r=0;if(t&&t.length>0){for(let s=0;s<t.length;s++){let _=t[s].price||0,l=t[s].quantity||1;i+=_*l,t[s].total_guests?r+=t[s].total_guests:(t[s].adults||t[s].kids)&&(r+=(t[s].adults||0)+(t[s].kids||0))}n.Items=t}else e.value&&(i=e.value);if(n.$value=parseFloat(i.toFixed(2)),e.currency&&(n.Currency=e.currency),r>0&&(n["Number of Guests"]=r),(e.start_date||e.check_in||e.checkin||e.check_in_date)&&(n.CheckIn=e.start_date||e.check_in||e.checkin||e.check_in_date),(e.end_date||e.check_out||e.checkout||e.check_out_date)&&(n.CheckOut=e.end_date||e.check_out||e.checkout||e.check_out_date),(e.total_guests||e.guests||e.guest_count)&&(n["Number of Guests"]=e.total_guests||e.guests||e.guest_count),t&&t.length>0&&t[0].nights&&(n["Number of Nights"]=t[0].nights),e.adults&&(n.$extra.adults=e.adults),(e.children||e.kids)&&(n.$extra.children=e.children||e.kids),(e.rooms||e.room_count)&&(n.$extra.number_of_rooms=e.rooms||e.room_count),n.CheckIn&&n.CheckOut)try{let s=new Date(n.CheckIn),_=new Date(n.CheckOut),l=Math.round((_-s)/(1e3*60*60*24));l>0&&(n["Number of Nights"]=l)}catch(s){}t&&t.length>0&&t[0].affiliation?n["Property Name"]=t[0].affiliation:e.property_name&&(n["Property Name"]=e.property_name),n.$extra={},e.property_id&&(n.$extra.property_id=e.property_id),e.coupon&&(n.$extra.coupon=e.coupon),e.tax&&(n.$extra.tax=e.tax),e.shipping&&(n.$extra.fees=e.shipping),e.be_source&&(n.$extra.booking_engine_source=e.be_source),o.track("Started Checkout",n)}let u=window.dataLayer;if(!u){return}let h=u.push;if(u.push=function(){let t=Array.prototype.slice.call(arguments);h.apply(window.dataLayer,t);let e;for(let o=0;o<t.length;o++)if(typeof t[o]=="object"){e=t[o];break}e&&d(e)},u.length,u.length>0)for(let t=0;t<u.length;t++)typeof u[t]=="object"&&(""+t,u[t],d(u[t]));let a=!1;function f(t){let e=window.klaviyo||[];t&&void 0,e.isIdentified&&typeof e.isIdentified=="function"?e.isIdentified().then(function(o){if(o){a=!0;return}y(t)}).catch(function(o){y(t)}):y(t)}function y(t){let e=window.klaviyo||[],o=document.querySelector('input[name="email"]')||document.querySelector('[data-testid="guest-form-email-input"]')||document.querySelector('input[type="email"]'),i=document.querySelector('input[name="phoneNumber"]')||document.querySelector('[data-testid="guest-form-phone-input"]')||document.querySelector('input[type="tel"][name="phoneNumber"]');let n=o?o.value.trim():"",r=i?i.value.trim():"";let s=n&&m(n),_=r&&r.length>0;if(!s&&n&&void 0,(s||_)&&!a){let l={};if(s&&(l.email=n),_&&(l.phone_number=r),l.email||l.phone_number){let k=document.querySelector('input[name="firstName"]')||document.querySelector('[data-testid="guest-form-first-name-input"]')||document.querySelector('input[autocomplete="given-name"]'),v=document.querySelector('input[name="lastName"]')||document.querySelector('[data-testid="guest-form-last-name-input"]')||document.querySelector('input[autocomplete="family-name"]');k&&k.value.trim()&&(l.first_name=k.value.trim()),v&&v.value.trim()&&(l.last_name=v.value.trim()),e.identify(l),a=!0}}else a?void 0:void 0}function p(){if(a)return;f("monitoring start");let t=document.getElementById("guest-form")||document.querySelector('form[data-testid="guest-form"]');if(!t){return}let e=t.querySelectorAll("input, textarea, select");""+e.length;for(let o=0;o<e.length;o++)(function(i){i.addEventListener("blur",function(){i.name||i.type,setTimeout(function(){f("field blur: "+(i.name||i.type))},500)})})(e[o]);t.addEventListener("submit",function(o){f("form submit")})}b()&&setTimeout(p,1e3);let I=u.push,E=function(){b()&&!a&&setTimeout(p,1e3)};window.addEventListener("popstate",E)})();})();
