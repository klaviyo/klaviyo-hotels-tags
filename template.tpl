___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Klaviyo Hotels Tag",
  "categories": ["EMAIL_MARKETING", "ANALYTICS", "MARKETING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Klaviyo Hotel Template for Mews, Cloudbeds, and Guesty",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "account_id",
    "displayName": "Klaviyo public API key",
    "simpleValueType": true,
    "help": "You can find your public key using these instructions: https://help.klaviyo.com/hc/en-us/articles/115005062267#h_01HRFPP8R1AEVQ744SE33FQTEC",
    "valueValidators": [
      {
        "type": "STRING_LENGTH",
        "args": [
          6,
          6
        ]
      }
    ],
    "valueHint": "6 digit account ID",
    "notSetText": "Enter your Klaviyo public key"
  },
  {
    "type": "SELECT",
    "name": "hotel_type",
    "displayName": "Which hotel PMS (Property Management System) do you use?",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "cloudbeds",
        "displayValue": "Cloudbeds"
      },
      {
        "value": "mews",
        "displayValue": "Mews"
      },
      {
        "value": "guesty",
        "displayValue": "Guesty"
      }
    ],
    "simpleValueType": true,
    "alwaysInSummary": true,
    "help": "Only customers using the booking engines for Mews, Guesty and Cloudbeds are supported today."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
  const encodeUriComponent = require('encodeUriComponent');
  const log = require('logToConsole');

  function initialiseKlaviyoTracking(){
    log('Klaviyo JS loaded, now loading hotel tracking script');
    if (data.hotel_type == "cloudbeds"){
      injectScript(
        'https://klaviyo.github.io/klaviyo-hotels-tags/public/klaviyo_hotel_tracking_cloudbeds.js',
        function() {
          log('Cloudbeds tracking script loaded successfully');
          data.gtmOnSuccess();
        },
        function() {
          log('Hotel tracking script FAILED to load');
          data.gtmOnFailure();
        }
      );
    } else if (data.hotel_type == "mews"){
      injectScript(
        'https://klaviyo.github.io/klaviyo-hotels-tags/public/klaviyo_hotel_tracking_mews.js',
        function() {
          log('Mews tracking script loaded successfully');
          data.gtmOnSuccess();
        },
        function() {
          log('Hotel tracking script FAILED to load');
          data.gtmOnFailure();
        }
      );
    } else {
      injectScript(
        'https://klaviyo.github.io/klaviyo-hotels-tags/public/klaviyo_hotel_tracking_guesty.js',
        function() {
          log('Guesty tracking script loaded successfully');
          data.gtmOnSuccess();
        },
        function() {
          log('Hotel tracking script FAILED to load');
          data.gtmOnFailure();
        }
      );
    }
  }

  function loadKlaviyoJS(){
    log('Loading Klaviyo JS');
    injectScript(
      'https://static.klaviyo.com/onsite/js/' + encodeUriComponent(data.account_id) + '/klaviyo.js',
      function() {
        log('Klaviyo JS success callback');
        initialiseKlaviyoTracking();
      },
      function() {
        log('Klaviyo JS FAILED callback');
        data.gtmOnFailure();
      }
    );
  }

  loadKlaviyoJS();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://static.klaviyo.com/onsite/js/*"
              },
              {
                "type": 1,
                "string": "https://klaviyo.github.io/klaviyo-hotels-tags/public/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 2/4/2026, 5:57:46 PM


